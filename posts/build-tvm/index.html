<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>TVM v0.7ビルド手順 |</title><meta name=Description content="programming and rock climbing"><meta property="og:title" content="TVM v0.7ビルド手順"><meta property="og:description" content="CAUTION 少し古い情報(2020/9頃)のため、2021/01/16時点では不要な情報の可能性が高いが、記録のために残しておく。 ビルド 1 2 sudo apt-get update sudo apt-get"><meta property="og:type" content="article"><meta property="og:url" content="https://mshr-h.com/posts/build-tvm/"><meta property="og:image" content="https://mshr-h.com/img/avatar.jpg"><meta property="article:published_time" content="2021-01-16T00:00:00+00:00"><meta property="article:modified_time" content="2021-01-16T16:06:32+09:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://mshr-h.com/img/avatar.jpg"><meta name=twitter:title content="TVM v0.7ビルド手順"><meta name=twitter:description content="CAUTION 少し古い情報(2020/9頃)のため、2021/01/16時点では不要な情報の可能性が高いが、記録のために残しておく。 ビルド 1 2 sudo apt-get update sudo apt-get"><meta name=application-name content="Keep Coding, Keep Climbing"><meta name=apple-mobile-web-app-title content="Keep Coding, Keep Climbing"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://mshr-h.com/posts/build-tvm/><link rel=prev href=https://mshr-h.com/posts/pipdeptree/><link rel=next href=https://mshr-h.com/posts/toeic-sw-test/><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/normalize.css@8.0.1/normalize.min.css><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.13.0/css/all.min.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@3.7.2/animate.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"TVM v0.7ビルド手順","inLanguage":"en","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/mshr-h.com\/posts\/build-tvm\/"},"genre":"posts","keywords":"TVM","wordCount":2526,"url":"https:\/\/mshr-h.com\/posts\/build-tvm\/","datePublished":"2021-01-16T00:00:00+00:00","dateModified":"2021-01-16T16:06:32+09:00","license":"This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher":{"@type":"Organization","name":"Masahiro Hiramori","logo":"https:\/\/mshr-h.com\/img\/avatar.jpg"},"author":{"@type":"Person","name":"     \"Masahiro Hiramori\""},"description":""}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Home","item":"https:\/\/mshr-h.com"},{"@type":"ListItem","position":2,"name":"Tech","item":"https://mshr-h.com/categories/tech/"},{"@type":"ListItem","position":3,"name":"TVM v0.7ビルド手順"}]}</script></head><body data-header-desktop=fixed data-header-mobile=auto><script>(window.localStorage&&localStorage.getItem('theme')?localStorage.getItem('theme')==='dark':('auto'==='auto'?window.matchMedia('(prefers-color-scheme: dark)').matches:'auto'==='dark'))&&document.body.setAttribute('theme','dark');</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title="Keep Coding, Keep Climbing" class=header-logo>Keep Coding, Keep Climbing</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>Posts </a><a class=menu-item href=/tags/>Tags </a><a class=menu-item href=/categories/>Categories </a><a class=menu-item href=/cv>CV </a><a class=menu-item href=/about>About </a><a class=menu-item href=https://github.com/mshr-h title=GitHub rel="noopener noreffer" target=_blank><i class="fab fa-github fa-fw"></i></a><span class="menu-item delimiter"></span><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme"><i class="fas fa-adjust fa-fw"></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="Keep Coding, Keep Climbing" class=header-logo>Keep Coding, Keep Climbing</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><a class=menu-item href=/posts/>Posts</a><a class=menu-item href=/tags/>Tags</a><a class=menu-item href=/categories/>Categories</a><a class=menu-item href=/cv>CV</a><a class=menu-item href=/about>About</a><a class=menu-item href=https://github.com/mshr-h title=GitHub rel="noopener noreffer" target=_blank><i class="fab fa-github fa-fw"></i></a><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw"></i></a></div></div></header><main class=main><div class="container content-article page-toc theme-classic"><div class=toc id=toc-auto><div class=toc-title>Contents</div><div class=toc-content id=toc-content-auto></div></div><div class=header-post><div class=post-title><div class=post-all-meta><div class=breadcrumbs><a href=/>Home </a>/ <a href=/categories/tech/>Tech </a>/ <a href=/>TVM v0.7ビルド手順</a></div><h1 class="single-title animated flipInX">TVM v0.7ビルド手順</h1><div class=post-meta><div class=post-meta-line><span class=post-category><a href=/categories/tech/><i class="far fa-folder fa-fw"></i>&nbsp;Tech</a>
</span>&nbsp;&nbsp;&nbsp;&nbsp;<i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time class=timeago datetime=2021-01-16>2021-01-16</time>&nbsp;&nbsp;&nbsp;&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;2526 words
&nbsp;&nbsp;&nbsp;&nbsp;<i class="far fa-clock fa-fw"></i>&nbsp;6 minutes</div></div></div></div></div><article class="single toc-start"><div class="content-block content-block-first content-block-position"><div class=post><div class="details toc" id=toc-static data-kept><div class="details-summary toc-title"><span>Contents</span>
<span><i class="details-icon fas fa-angle-right"></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#caution>CAUTION</a></li><li><a href=#ビルド>ビルド</a></li><li><a href=#ビルドエラーの詳細>ビルドエラーの詳細</a><ul><li><a href=#elementcountunsigned-int-boolのアクセス修飾子の変更経緯を追いかける><code>ElementCount(unsigned int, bool)</code>のアクセス修飾子の変更経緯を追いかける。</a></li></ul></li></ul></nav></div></div><h2 id=caution>CAUTION</h2><p>少し古い情報(2020/9頃)のため、2021/01/16時点では不要な情報の可能性が高いが、記録のために残しておく。</p><h2 id=ビルド>ビルド</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-bash data-lang=bash>sudo apt-get update
sudo apt-get install -y python3 python3-dev python3-setuptools gcc libtinfo-dev zlib1g-dev build-essential cmake libedit-dev libxml2-dev ninja-build
</code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-bash data-lang=bash><span class=nb>cd</span> ~/workspace
git clone https://github.com/llvm/llvm-project.git
<span class=nb>cd</span> llvm-project <span class=o>&amp;&amp;</span> git checkout llvmorg-10.0.1 <span class=o>&amp;&amp;</span> <span class=nb>cd</span> ..
</code></pre></td></tr></table></div></div><p>TVMと<a href=https://github.com/onnx/onnx-mlir target=_blank rel="noopener noreffer">ONNX-MLIR</a>を共存するために、ONNX-MLIRが依存する<a href=https://github.com/llvm/llvm-project/tree/1d01fc target=_blank rel="noopener noreffer">LLVM@1d01fc</a>(未リリースのバージョン)を使ってTVMをビルドすると、ビルドエラーが発生する。(後述)</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-bash data-lang=bash><span class=nb>cd</span> ~/workspace
git clone --recursive https://github.com/apache/incubator-tvm tvm
mkdir build
cp cmake/config.cmake build
<span class=nb>cd</span> build
</code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-bash data-lang=bash>vim config.cmake
</code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span><span class=lnt>143
</span><span class=lnt>144
</span><span class=lnt>145
</span><span class=lnt>146
</span><span class=lnt>147
</span><span class=lnt>148
</span><span class=lnt>149
</span><span class=lnt>150
</span><span class=lnt>151
</span><span class=lnt>152
</span><span class=lnt>153
</span><span class=lnt>154
</span><span class=lnt>155
</span><span class=lnt>156
</span><span class=lnt>157
</span><span class=lnt>158
</span><span class=lnt>159
</span><span class=lnt>160
</span><span class=lnt>161
</span><span class=lnt>162
</span><span class=lnt>163
</span><span class=lnt>164
</span><span class=lnt>165
</span><span class=lnt>166
</span><span class=lnt>167
</span><span class=lnt>168
</span><span class=lnt>169
</span><span class=lnt>170
</span><span class=lnt>171
</span><span class=lnt>172
</span><span class=lnt>173
</span><span class=lnt>174
</span><span class=lnt>175
</span><span class=lnt>176
</span><span class=lnt>177
</span><span class=lnt>178
</span><span class=lnt>179
</span><span class=lnt>180
</span><span class=lnt>181
</span><span class=lnt>182
</span><span class=lnt>183
</span><span class=lnt>184
</span><span class=lnt>185
</span><span class=lnt>186
</span><span class=lnt>187
</span><span class=lnt>188
</span><span class=lnt>189
</span><span class=lnt>190
</span><span class=lnt>191
</span><span class=lnt>192
</span><span class=lnt>193
</span><span class=lnt>194
</span><span class=lnt>195
</span><span class=lnt>196
</span><span class=lnt>197
</span><span class=lnt>198
</span><span class=lnt>199
</span><span class=lnt>200
</span><span class=lnt>201
</span><span class=lnt>202
</span><span class=lnt>203
</span><span class=lnt>204
</span><span class=lnt>205
</span><span class=lnt>206
</span><span class=lnt>207
</span><span class=lnt>208
</span><span class=lnt>209
</span><span class=lnt>210
</span><span class=lnt>211
</span><span class=lnt>212
</span><span class=lnt>213
</span><span class=lnt>214
</span><span class=lnt>215
</span><span class=lnt>216
</span><span class=lnt>217
</span><span class=lnt>218
</span><span class=lnt>219
</span><span class=lnt>220
</span><span class=lnt>221
</span><span class=lnt>222
</span><span class=lnt>223
</span><span class=lnt>224
</span><span class=lnt>225
</span><span class=lnt>226
</span><span class=lnt>227
</span><span class=lnt>228
</span><span class=lnt>229
</span><span class=lnt>230
</span><span class=lnt>231
</span><span class=lnt>232
</span><span class=lnt>233
</span><span class=lnt>234
</span><span class=lnt>235
</span><span class=lnt>236
</span><span class=lnt>237
</span><span class=lnt>238
</span><span class=lnt>239
</span><span class=lnt>240
</span><span class=lnt>241
</span><span class=lnt>242
</span><span class=lnt>243
</span><span class=lnt>244
</span><span class=lnt>245
</span><span class=lnt>246
</span><span class=lnt>247
</span><span class=lnt>248
</span><span class=lnt>249
</span><span class=lnt>250
</span><span class=lnt>251
</span><span class=lnt>252
</span><span class=lnt>253
</span><span class=lnt>254
</span><span class=lnt>255
</span><span class=lnt>256
</span><span class=lnt>257
</span><span class=lnt>258
</span><span class=lnt>259
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-text data-lang=text># Licensed to the Apache Software Foundation (ASF) under one
# or more contributor license agreements.  See the NOTICE file
# distributed with this work for additional information
# regarding copyright ownership.  The ASF licenses this file
# to you under the Apache License, Version 2.0 (the
# &#34;License&#34;); you may not use this file except in compliance
# with the License.  You may obtain a copy of the License at
#
#   http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing,
# software distributed under the License is distributed on an
# &#34;AS IS&#34; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
# KIND, either express or implied.  See the License for the
# specific language governing permissions and limitations
# under the License.

#--------------------------------------------------------------------
#  Template custom cmake configuration for compiling
#
#  This file is used to override the build options in build.
#  If you want to change the configuration, please use the following
#  steps. Assume you are on the root directory. First copy the this
#  file so that any local changes will be ignored by git
#
#  $ mkdir build
#  $ cp cmake/config.cmake build
#
#  Next modify the according entries, and then compile by
#
#  $ cd build
#  $ cmake ..
#
#  Then build in parallel with 8 threads
#
#  $ make -j8
#--------------------------------------------------------------------

#---------------------------------------------
# Backend runtimes.
#---------------------------------------------

# Whether enable CUDA during compile,
#
# Possible values:
# - ON: enable CUDA with cmake&#39;s auto search
# - OFF: disable CUDA
# - /path/to/cuda: use specific path to cuda toolkit
set(USE_CUDA OFF)

# Whether enable ROCM runtime
#
# Possible values:
# - ON: enable ROCM with cmake&#39;s auto search
# - OFF: disable ROCM
# - /path/to/rocm: use specific path to rocm
set(USE_ROCM OFF)

# Whether enable SDAccel runtime
set(USE_SDACCEL OFF)

# Whether enable Intel FPGA SDK for OpenCL (AOCL) runtime
set(USE_AOCL OFF)

# Whether enable OpenCL runtime
#
# Possible values:
# - ON: enable OpenCL with cmake&#39;s auto search
# - OFF: disable OpenCL
# - /path/to/opencl-sdk: use specific path to opencl-sdk
set(USE_OPENCL OFF)

# Whether enable Metal runtime
set(USE_METAL OFF)

# Whether enable Vulkan runtime
#
# Possible values:
# - ON: enable Vulkan with cmake&#39;s auto search
# - OFF: disable vulkan
# - /path/to/vulkan-sdk: use specific path to vulkan-sdk
set(USE_VULKAN OFF)

# Whether enable OpenGL runtime
set(USE_OPENGL OFF)

# Whether enable MicroTVM runtime
set(USE_MICRO ON)

# Whether to enable SGX runtime
#
# Possible values for USE_SGX:
# - /path/to/sgxsdk: path to Intel SGX SDK
# - OFF: disable SGX
#
# SGX_MODE := HW|SIM
set(USE_SGX OFF)
set(SGX_MODE &#34;SIM&#34;)
set(RUST_SGX_SDK &#34;/path/to/rust-sgx-sdk&#34;)

# Whether enable RPC runtime
set(USE_RPC ON)

# Whether to build the C++ RPC server binary
set(USE_CPP_RPC ON)

# Whether embed stackvm into the runtime
set(USE_STACKVM_RUNTIME OFF)

# Whether enable tiny embedded graph runtime.
set(USE_GRAPH_RUNTIME ON)

# Whether enable additional graph debug functions
set(USE_GRAPH_RUNTIME_DEBUG ON)

# Whether enable additional vm profiler functions
set(USE_VM_PROFILER ON)

# Whether enable uTVM standalone runtime
set(USE_MICRO_STANDALONE_RUNTIME ON)

# Whether build with LLVM support
# Requires LLVM version &gt;= 4.0
#
# Possible values:
# - ON: enable llvm with cmake&#39;s find search
# - OFF: disable llvm
# - /path/to/llvm-config: enable specific LLVM when multiple llvm-dev is available.
set(USE_LLVM /home/ubuntu/workspace/llvm-project/build/bin/llvm-config)

#---------------------------------------------
# Contrib libraries
#---------------------------------------------
# Whether use BLAS, choices: openblas, atlas, apple
set(USE_BLAS none)

# Whether to use MKL
# Possible values:
# - ON: Enable MKL
# - /path/to/mkl: mkl root path
# - OFF: Disable MKL
# set(USE_MKL /opt/intel/mkl) for UNIX
# set(USE_MKL ../IntelSWTools/compilers_and_libraries_2018/windows/mkl) for WIN32
# set(USE_MKL &lt;path to venv or site-packages directory&gt;) if using `pip install mkl`
set(USE_MKL OFF)

# Whether use MKLDNN library, choices: ON, OFF, path to mkldnn library
set(USE_MKLDNN OFF)

# Whether use OpenMP thread pool, choices: gnu, intel
# Note: &#34;gnu&#34; uses gomp library, &#34;intel&#34; uses iomp5 library
set(USE_OPENMP none)

# Whether use contrib.random in runtime
set(USE_RANDOM ON)

# Whether use NNPack
set(USE_NNPACK OFF)

# Possible values:
# - ON: enable tflite with cmake&#39;s find search
# - OFF: disable tflite
# - /path/to/libtensorflow-lite.a: use specific path to tensorflow lite library
set(USE_TFLITE OFF)

# /path/to/tensorflow: tensorflow root path when use tflite library
set(USE_TENSORFLOW_PATH none)

# Required for full builds with TFLite. Not needed for runtime with TFLite.
# /path/to/flatbuffers: flatbuffers root path when using tflite library
set(USE_FLATBUFFERS_PATH none)

# Possible values:
# - OFF: disable tflite support for edgetpu
# - /path/to/edgetpu: use specific path to edgetpu library
set(USE_EDGETPU OFF)

# Whether use CuDNN
set(USE_CUDNN OFF)

# Whether use cuBLAS
set(USE_CUBLAS OFF)

# Whether use MIOpen
set(USE_MIOPEN OFF)

# Whether use MPS
set(USE_MPS OFF)

# Whether use rocBlas
set(USE_ROCBLAS OFF)

# Whether use contrib sort
set(USE_SORT ON)

# Whether use MKL-DNN (DNNL) codegen
set(USE_DNNL_CODEGEN OFF)

# Whether to use Arm Compute Library (ACL) codegen
# We provide 2 separate flags since we cannot build the ACL runtime on x86.
# This is useful for cases where you want to cross-compile a relay graph
# on x86 then run on AArch.
#
# An example of how to use this can be found here: docs/deploy/arm_compute_lib.rst.
#
# USE_ARM_COMPUTE_LIB - Support for compiling a relay graph offloading supported
#                       operators to Arm Compute Library. OFF/ON
# USE_ARM_COMPUTE_LIB_GRAPH_RUNTIME - Run Arm Compute Library annotated functions via the ACL
#                                     runtime. OFF/ON/&#34;path/to/ACL&#34;
set(USE_ARM_COMPUTE_LIB OFF)
set(USE_ARM_COMPUTE_LIB_GRAPH_RUNTIME OFF)

# Whether to build with Arm Ethos-N support
# Possible values:
# - OFF: disable Arm Ethos-N support
# - path/to/arm-ethos-N-stack: use a specific version of the
#   Ethos-N driver stack
set(USE_ETHOSN OFF)
# If USE_ETHOSN is enabled, use ETHOSN_HW (ON) if Ethos-N hardware is available on this machine
# otherwise use ETHOSN_HW (OFF) to use the software test infrastructure
set(USE_ETHOSN_HW OFF)

# Build ANTLR parser for Relay text format
# Possible values:
# - ON: enable ANTLR by searching default locations (cmake find_program for antlr4 and /usr/local for jar)
# - OFF: disable ANTLR
# - /path/to/antlr-*-complete.jar: path to specific ANTLR jar file
set(USE_ANTLR OFF)

# Whether use Relay debug mode
set(USE_RELAY_DEBUG ON)

# Whether to build fast VTA simulator driver
set(USE_VTA_FSIM OFF)

# Whether to build cycle-accurate VTA simulator driver
set(USE_VTA_TSIM OFF)

# Whether to build VTA FPGA driver (device side only)
set(USE_VTA_FPGA OFF)

# Whether use Thrust
set(USE_THRUST OFF)

# Whether to build the TensorFlow TVMDSOOp module
set(USE_TF_TVMDSOOP OFF)

# Whether to use STL&#39;s std::unordered_map or TVM&#39;s POD compatible Map
set(USE_FALLBACK_STL_MAP OFF)

# Whether to use hexagon device
set(USE_HEXAGON_DEVICE OFF)
set(USE_HEXAGON_SDK /path/to/sdk)

# Whether to use ONNX codegen
set(USE_TARGET_ONNX ON)

# Whether to compile the standalone C runtime.
set(USE_STANDALONE_CRT ON)
</code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-bash data-lang=bash>cmake .. -G Ninja
ninja
</code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-bash data-lang=bash><span class=nb>export</span> <span class=nv>TVM_HOME</span><span class=o>=</span>/path/to/tvm
<span class=nb>export</span> <span class=nv>PYTHONPATH</span><span class=o>=</span><span class=nv>$TVM_HOME</span>/python:<span class=si>${</span><span class=nv>PYTHONPATH</span><span class=si>}</span>
</code></pre></td></tr></table></div></div><h2 id=ビルドエラーの詳細>ビルドエラーの詳細</h2><p><a href=https://github.com/llvm/llvm-project/tree/1d01fc target=_blank rel="noopener noreffer">LLVM@1d01fc</a>を使用してTVMをビルドすると下記エラーが発生する。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>[17/85] Building CXX object CMakeFiles/tvm_objs.dir/src/target/llvm/codegen_llvm.cc.o
FAILED: CMakeFiles/tvm_objs.dir/src/target/llvm/codegen_llvm.cc.o 
/usr/bin/c++  -DBUILD_EXAMPLES -DDMLC_USE_FOPEN64=0 -DTVM_INDEX_DEFAULT_I64=1 -DTVM_LLVM_VERSION=120 -DTVM_THREADPOOL_USE_OPENMP=0 -DUSE_FALLBACK_STL_MAP=0 -DUSE_MICRO_STANDALONE_RUNTIME=1 -D_DEBUG -D_GNU_SOURCE -D__STDC_CONSTANT_MACROS -D__STDC_FORMAT_MACROS -D__STDC_LIMIT_MACROS -DDMLC_ENABLE_RTTI=0 -I../include -I../3rdparty/dlpack/include -I../3rdparty/dmlc-core/include -I../3rdparty/rang/include -I../3rdparty/compiler-rt -I../3rdparty/picojson -I/home/ubuntu/workspace/llvm-project/llvm/include -I/home/ubuntu/workspace/llvm-project/build/include -I../topi/include -std=c++14 -faligned-new -O2 -Wall -fPIC    -fno-rtti -MD -MT CMakeFiles/tvm_objs.dir/src/target/llvm/codegen_llvm.cc.o -MF CMakeFiles/tvm_objs.dir/src/target/llvm/codegen_llvm.cc.o.d -o CMakeFiles/tvm_objs.dir/src/target/llvm/codegen_llvm.cc.o -c ../src/target/llvm/codegen_llvm.cc
../src/target/llvm/codegen_llvm.cc: In member function ‘llvm::Value* tvm::codegen::CodeGenLLVM::CreateBroadcast(llvm::Value*, int)’:
../src/target/llvm/codegen_llvm.cc:480:82: error: ‘llvm::ElementCount::ElementCount(unsigned int, bool)’ is private within this context
  480 |       llvm::ConstantVector::getSplat(llvm::ElementCount(lanes, /*Scalable=*/false), zero);
      |                                                                                  ^
In file included from /home/ubuntu/workspace/llvm-project/llvm/include/llvm/IR/Type.h:24,
                 from /home/ubuntu/workspace/llvm-project/llvm/include/llvm/IR/DerivedTypes.h:23,
                 from /home/ubuntu/workspace/llvm-project/llvm/include/llvm/IR/Constants.h:31,
                 from /home/ubuntu/workspace/llvm-project/llvm/include/llvm/IR/Operator.h:19,
                 from /home/ubuntu/workspace/llvm-project/llvm/include/llvm/Analysis/TargetTransformInfo.h:24,
                 from ../src/target/llvm/llvm_common.h:33,
                 from ../src/target/llvm/codegen_llvm.h:49,
                 from ../src/target/llvm/codegen_llvm.cc:25:
/home/ubuntu/workspace/llvm-project/llvm/include/llvm/Support/TypeSize.h:39:3: note: declared private here
   39 |   ElementCount(unsigned Min, bool Scalable) : Min(Min), Scalable(Scalable) {}
      |   ^~~~~~~~~~~~
[22/85] Building CXX object CMakeFiles/tvm_objs.dir/src/runtime/rpc/rpc_endpoint.cc.o
ninja: build stopped: subcommand failed.
</code></pre></td></tr></table></div></div><p>エラーメッセージを読むと、privateメソッドとして定義されている<code>llvm::ElementCount::ElementCount(unsigned int, bool)</code>を
クラス外から呼び出そうとしているのが原因。</p><p>実際にLLVMの<a href=https://github.com/llvm/llvm-project/blob/1d01fc/llvm/include/llvm/Support/TypeSize.h#L39 target=_blank rel="noopener noreffer">TypeSize.h@1d01fc</a>を見ると、そのように定義されている。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-cpp data-lang=cpp><span class=k>class</span> <span class=nc>ElementCount</span> <span class=p>{</span>
<span class=k>private</span><span class=o>:</span>
  <span class=kt>unsigned</span> <span class=n>Min</span><span class=p>;</span>  <span class=c1>// Minimum number of vector elements.
</span><span class=c1></span>  <span class=kt>bool</span> <span class=n>Scalable</span><span class=p>;</span> <span class=c1>// If true, NumElements is a multiple of &#39;Min&#39; determined
</span><span class=c1></span>                 <span class=c1>// at runtime rather than compile time.
</span><span class=c1></span>
  <span class=c1>/// Prevent code from using initializer-list contructors like
</span><span class=c1></span>  <span class=c1>/// ElementCount EC = {&lt;unsigned&gt;, &lt;bool&gt;}. The static `get*`
</span><span class=c1></span>  <span class=c1>/// methods below are preferred, as users should always make a
</span><span class=c1></span>  <span class=c1>/// conscious choice on the type of `ElementCount` they are
</span><span class=c1></span>  <span class=c1>/// requesting.
</span><span class=c1></span>  <span class=n>ElementCount</span><span class=p>(</span><span class=kt>unsigned</span> <span class=n>Min</span><span class=p>,</span> <span class=kt>bool</span> <span class=n>Scalable</span><span class=p>)</span> <span class=o>:</span> <span class=n>Min</span><span class=p>(</span><span class=n>Min</span><span class=p>),</span> <span class=n>Scalable</span><span class=p>(</span><span class=n>Scalable</span><span class=p>)</span> <span class=p>{}</span>
</code></pre></td></tr></table></div></div><p>コメントには、下記の<code>get</code>スタティックメソッドを推奨する旨が書いているが、TVM側がこの変更に追いついてないためビルドエラーが発生した。</p><p><a href=https://github.com/llvm/llvm-project/blob/1d01fc/llvm/include/llvm/Support/TypeSize.h#L77-L79 target=_blank rel="noopener noreffer">TypeSize.h@1d01fc</a></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-cpp data-lang=cpp>  <span class=k>static</span> <span class=n>ElementCount</span> <span class=nf>get</span><span class=p>(</span><span class=kt>unsigned</span> <span class=n>Min</span><span class=p>,</span> <span class=kt>bool</span> <span class=n>Scalable</span><span class=p>)</span> <span class=p>{</span>
    <span class=k>return</span> <span class=p>{</span><span class=n>Min</span><span class=p>,</span> <span class=n>Scalable</span><span class=p>};</span>
  <span class=p>}</span>
</code></pre></td></tr></table></div></div><h3 id=elementcountunsigned-int-boolのアクセス修飾子の変更経緯を追いかける><code>ElementCount(unsigned int, bool)</code>のアクセス修飾子の変更経緯を追いかける。</h3><p><a href=https://github.com/llvm/llvm-project/commit/b302561 target=_blank rel="noopener noreffer">b302561 (Oct 8, 2019, 9:53 PM GMT+9)</a>で該当行を含むファイルが新規作成される。この時点で<code>ElementCount(unsigned Min, bool Scalable)</code>はpublicメソッドとして定義されている。</p><p><a href=https://github.com/llvm/llvm-project/blob/b302561/llvm/include/llvm/Support/TypeSize.h#L28-L29 target=_blank rel="noopener noreffer">TypeSize.h@b302561</a></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-cpp data-lang=cpp><span class=k>class</span> <span class=nc>ElementCount</span> <span class=p>{</span>
<span class=k>public</span><span class=o>:</span>
  <span class=kt>unsigned</span> <span class=n>Min</span><span class=p>;</span>  <span class=c1>// Minimum number of vector elements.
</span><span class=c1></span>  <span class=kt>bool</span> <span class=n>Scalable</span><span class=p>;</span> <span class=c1>// If true, NumElements is a multiple of &#39;Min&#39; determined
</span><span class=c1></span>                 <span class=c1>// at runtime rather than compile time.
</span><span class=c1></span>
  <span class=n>ElementCount</span><span class=p>(</span><span class=kt>unsigned</span> <span class=n>Min</span><span class=p>,</span> <span class=kt>bool</span> <span class=n>Scalable</span><span class=p>)</span>
  <span class=o>:</span> <span class=n>Min</span><span class=p>(</span><span class=n>Min</span><span class=p>),</span> <span class=n>Scalable</span><span class=p>(</span><span class=n>Scalable</span><span class=p>)</span> <span class=p>{}</span>
</code></pre></td></tr></table></div></div><p><a href=https://github.com/llvm/llvm-project/commit/a407ec target=_blank rel="noopener noreffer">a407ec (Aug 20, 2020, 2:26 AM GMT+9)</a>で<code>ElementCount(unsigned Min, bool Scalable)</code>がpublicからprivateへ変更される。(これが1d01fc時点のコード)</p><p><a href=https://github.com/llvm/llvm-project/blob/a407ec/llvm/include/llvm/Support/TypeSize.h#L28-L35 target=_blank rel="noopener noreffer">TypeSize.h@a407ec</a></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-cpp data-lang=cpp><span class=k>class</span> <span class=nc>ElementCount</span> <span class=p>{</span>
<span class=k>private</span><span class=o>:</span>
  <span class=c1>/// Prevent code from using initializer-list contructors like
</span><span class=c1></span>  <span class=c1>/// ElementCount EC = {&lt;unsigned&gt;, &lt;bool&gt;}. The static `get*`
</span><span class=c1></span>  <span class=c1>/// methods below are preferred, as users should always make a
</span><span class=c1></span>  <span class=c1>/// conscious choice on the type of `ElementCount` they are
</span><span class=c1></span>  <span class=c1>/// requesting.
</span><span class=c1></span>  <span class=n>ElementCount</span><span class=p>(</span><span class=kt>unsigned</span> <span class=n>Min</span><span class=p>,</span> <span class=kt>bool</span> <span class=n>Scalable</span><span class=p>)</span> <span class=o>:</span> <span class=n>Min</span><span class=p>(</span><span class=n>Min</span><span class=p>),</span> <span class=n>Scalable</span><span class=p>(</span><span class=n>Scalable</span><span class=p>)</span> <span class=p>{}</span>
</code></pre></td></tr></table></div></div><p><code>llvmorg-10.0.1</code>はb302561のコードを使用している(=publicメソッドとして定義されている)ため、問題なくビルドできる。</p></div><div class=post><div class=post-info-share><span><a class="share-icon share-twitter" href=javascript:void(0); title="Share on Twitter" data-sharer=twitter data-url=https://mshr-h.com/posts/build-tvm/ data-title="TVM v0.7ビルド手順" data-via=mshrh3 data-hashtags=TVM><i class="fab fa-twitter fa-fw"></i></a></span></div><div class=footer-post-author style="border-radius:10px;border-bottom:solid 2px #ececec"><div class=author-avatar><a href target=_blank><img alt src border=0></a></div><div class=author-info><div class=name><a href target=_blank></a></div><div class=number-posts></span></div></div></div><div class=post-footer id=post-footer><div class=post-navigation><div class="post-nav-box nav-box-prev"><a class=nav-box href=/posts/pipdeptree/><span class=nav-icon><svg aria-hidden="true" data-prefix="fas" data-icon="chevron-circle-left" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M256 504C119 504 8 393 8 256S119 8 256 8s248 111 248 248-111 248-248 248zM142.1 273l135.5 135.5c9.4 9.4 24.6 9.4 33.9.0l17-17c9.4-9.4 9.4-24.6.0-33.9L226.9 256l101.6-101.6c9.4-9.4 9.4-24.6.0-33.9l-17-17c-9.4-9.4-24.6-9.4-33.9.0L142.1 239c-9.4 9.4-9.4 24.6.0 34z"/></svg></span><div style=text-align:right;padding-left:10px><div class=nav-text-h>Next article</div><span class=nav-text>pipdeptreeでPythonパッケージの依存ツリーを見る</span></div></a></div><div class="post-nav-box nav-box-next"><a class=nav-box href=/posts/toeic-sw-test/><div style=padding-right:10px><div class=nav-text-h>Next article</div><span class=nav-text>TOEIC S&W受験記録(2020/8)</span></div><span class=nav-icon><svg aria-hidden="true" data-prefix="fas" data-icon="chevron-circle-right" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M256 8c137 0 248 111 248 248S393 504 256 504 8 393 8 256 119 8 256 8zm113.9 231L234.4 103.5c-9.4-9.4-24.6-9.4-33.9.0l-17 17c-9.4 9.4-9.4 24.6.0 33.9L285.1 256 183.5 357.6c-9.4 9.4-9.4 24.6.0 33.9l17 17c9.4 9.4 24.6 9.4 33.9.0L369.9 273c9.4-9.4 9.4-24.6.0-34z"/></svg></span></a></div></div></div></div></div><div id=toc-final></div></article><div class="post-tags post-tags-toc"><a href=/tags/tvm/ class=tag>TVM</a></div></div></main><footer class=footer><div class=footer-container><div class=footer-line>Powered by <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.80.0">Hugo</a> | Theme - <a href="https://ublogger.netlify.app/?utm_source=https://mshr-h.com&utm_medium=footer&utm_campaign=config&utm_term=1.2.0" target=_blank title="uBlogger 1.2.0"><i class="fas fa-pencil-alt fa-fw"></i>uBlogger</a></div><div class=footer-line><i class="far fa-copyright fa-fw"></i><span>2018 - 2021</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=https://mshr-h.com target=_blank>Masa</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw"></i></a><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw"></i></a></div><link rel=stylesheet href=/custom.css><script src=https://cdn.jsdelivr.net/npm/smooth-scroll@16.1.3/dist/smooth-scroll.min.js></script><script src=https://cdn.jsdelivr.net/npm/lazysizes@5.2.2/lazysizes.min.js></script><script src=https://cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js></script><script src=https://cdn.jsdelivr.net/npm/sharer.js@0.4.0/sharer.min.js></script><script>window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":10}};</script><script src=/js/theme.min.js></script><script src=/js/jquery-3.5.1.min.js></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-165309045-1','auto');ga('set','anonymizeIp',true);ga('send','pageview');</script><script>(function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};m[i].l=1*new Date();k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
(window,document,"script","https://mc.yandex.ru/metrika/tag.js","ym");ym("70532758","init",{clickmap:true,trackLinks:true,accurateTrackBounce:true});</script><noscript><div><img src=https://mc.yandex.ru/watch/69594475 style=position:absolute;left:-9999px alt></div></noscript></body></html>